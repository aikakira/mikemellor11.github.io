{{> header header--text=(findObjectInArray object="gym" in=@root.global.navigation key="url" value="name")}}

{{> banner title="Gym" content="Please don't contact me in regards to any WSM competitions, im busy"}}

<main class="container">
	<div class="innerContainer ut-padding ut-mobileFullChildren">

		<div class="twoThirds">
			<div class="delta">
				<svg class="chart chart3"></svg>
			</div>
		</div>

		<div class="third last">
			<div class="delta">
				<svg class="chart chart2"></svg>
			</div>
		</div>

		<div class="full">
			<div class="delta">
				<svg class="chart chart1"></svg>
			</div>
		</div>

		<div class="fifth">
			<ul class="d3__list--workouts">
			</ul>
		</div>

		<div class="fourFifths ut-vertAlignTop last">
			<table class="siteStatus table__responsive d3-exercise">
			</table>
		</div>

		<div class="full last ut-vertAlignTop">
			<div class="ut-padding ut-marginBottom">
				<select class="full js-chartSelect">
					{{#each index.charts}}
						<option>{{name}}</option>
					{{/each}}
				</select>
			</div>
			<div class="key">
			</div>
		</div>

	</div>
</main>

<script type="text/javascript">
	function pageJS(){
		chartManager.init(function(){
			var gym = Gym(chartManager.all);
			var chest = Gym(chartManager.chest);

			chartManager.htmlList('.d3__list--workouts', gym.date(true).splice(0, 10));

			chartManager.htmlWorkout('.d3-exercise', gym.last());

			var data = [];
			var data2 = [];
			var data3 = [];

			gym.each(function(d, i){
				var weights = d.workouts().sets().weight();
				var exercise = d.exercise();
				var data3Hold = [];

				data.push({
					"label": exercise,
					"values": weights.map(function(dl, il){
						return {
		                    "id": il,
		                    "value": dl,
		                    "label": (il === (weights.length - 1)) ? exercise : ''
		                }
					})
				});

				data2.push({ 
					"data": d.max(),
					"label": exercise
				});

				d.workouts().each(function(dl, il){
					if(il < d.workouts().length() - 4){
						return;
					}

					data3Hold.push({
			            "id": i + 'a' + il,
			            "label": (il === d.workouts().length() - 3) ? exercise : '',
			            "value": dl.max()
			        });
				});

				data3.push({
					"values": data3Hold
				});
			});

			Line('.chart1', true)
				.data(data)
				.att({
					xLabel: "Set",
					yLabel: "Weight",
					margin: {
						left: 50
					}
				})
				.render();

			Pie('.chart2', true)
				.data(data2)
				.att({
					showLabels: true,
					innerRadius: 0.5,
					labelFormat: "{0} kg {1}",
					labelMaxWidth: 120
				})
				.render();

			Bar('.chart3', true)
				.att({
					barGap: 0.01,
					padding: {
						left: 0.01,
						right: 0.01
					},
					displayBar: true,
					dataLevels: 1,
					yLabel: "Max weight (workouts stacked)",
					margin: {
						left: 60
					}
				})
				.data(data3)
				.render();

			document.querySelector('.d3__list--workouts').onclick = function(e){
				if(e.target.classList.contains('d3__list--workouts')){
					return;
				}

		    	chartManager.htmlWorkout('.d3-exercise', gym.workout(e.target.innerHTML));
		    	this.querySelector('.externalLink').classList.remove('externalLink');
		    	e.target.classList.add('externalLink');
		    };
		});

		/*document.querySelector('.js-chartSelect').onchange = function(){
	    	chartManager.chartIndex = this.selectedIndex;
	    	chartManager.update();
	    };*/
	}
</script>