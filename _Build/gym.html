{{#> base}}

	{{> header header--text=(findObjectInArray object="gym" in=@root.global.navigation key="url" value="name")}}

	{{> banner title="Gym" content="Please don't contact me in regards to any WSM competitions, im busy"}}

	<main class="container">
		<div class="innerContainer ut-padding ut-mobileFullChildren">

			<div class="twoThirds ut-vertAlignTop">
				<h3>Max weight</h3>
				{{> chart name='chart3'}}
			</div>

			<div class="third last">
				<h3>Targets hit</h3>
				{{> chart name='chart2' class="delta--full"}}

				<h3>Intensity</h3>
				{{> chart name='chart4' class="delta--full"}}
			</div>

			<div class="full">
				<h3>Sets</h3>
				{{> chart name='chart1'}}
			</div>

			<div class="full">
				<h3>Weight</h3>
				{{> chart name='chart5'}}
			</div>

			<div class="fifth">
				<ul class="d3__list--workouts">
				</ul>
			</div>

			<div class="fourFifths ut-vertAlignTop last">
				<table class="siteStatus table__responsive d3-exercise">
				</table>
			</div>

			<div class="full last ut-vertAlignTop">
				<div class="ut-padding ut-marginBottom">
					<select class="full js-chartSelect">
						{{#each index.charts}}
							<option>{{name}}</option>
						{{/each}}
					</select>
				</div>
				<div class="key">
				</div>
			</div>

		</div>
	</main>

	<script type="text/javascript">
		function pageJS(){
			chartManager.init(function(){
				var gym = Gym(chartManager.all);
				var chest = Gym(chartManager.chest);

				chartManager.htmlList('.d3__list--workouts', gym.date(true).splice(0, 10));

				chartManager.htmlWorkout('.d3-exercise', gym.last());

				var data = [];
				var data2 = [0, 0];

				var data3 = [];
				var data4 = [
					{
						"data": 0,
						"label": 'Low'
					},
					{
						"data": 0,
						"label": 'Medium'
					},
					{
						"data": 0,
						"label": 'High'
					}
				]

				var data5 = [
					{
						"label": "",
						"values": []
					}
				];

				chartManager.weight.forEach(function(d, i){
					data5[0].values.push({
	                    "id": d.date,
	                    "value": d.weight,
	                    "label": ''
					});
				});

				gym.select(['Deadlifts', 'Squats', 'Overhead press', 'Bench press']).each(function(d, i){
					var workout = d.workouts();
					var exercise = d.exercise();
					var sets = workout.sets();
					var weights = sets.weight();

					data.push({
						"label": exercise,
						"values": weights.map(function(dl, il){
							return {
			                    "id": il,
			                    "value": dl,
			                    "label": (il === (weights.length - 1)) ? exercise : ''
			                }
						})
					});

					workout.each(function(dl, il){
						data2[dl.target() | 0] += 1;

						switch(dl.intensity()){
							case 'Low':
								data4[0].data += 1;
								break;
							case 'Medium':
								data4[1].data += 1;
								break;
							case 'High':
								data4[2].data += 1;
								break;
						}

						if(il < workout.length() - 4){
							return;
						}
					});

					data3.push({
			            "id": i,
			            "label": exercise,
			            "value": d.max()
			        });
				});

				var delay = 500;
				var delaySpeed = 500;

				setTimeout(function(){
					d3.select('.chart3').node().parentNode.classList.add('async--finished');

					Bar('.chart3', true)
						.data(data3)
						.att({
							width: 674,
							barGap: 0.025,
							padding: {
								left: 0.025,
								right: 0.025
							},
							displayBar: true,
							yLabel: "Max weight",
							margin: {
								left: 60
							},
							stagger: 50,
							delaySpeed: delaySpeed,
							showXAxis: false
						})
						.init()
						.render();
				}, delay);

				setTimeout(function(){
					d3.select('.chart2').node().parentNode.classList.add('async--finished');

					Pie('.chart2', true)
						.data([
							{
								"data": data2[1],
								"label": ''
							}
						])
						.att({
							width: 328,
							height: 328,
							innerRadius: 0.5,
							harveyBall: true,
							totalCount: data2[0] + data2[1],
							showCenterPercent: true,
							delaySpeed: delaySpeed,
						})
						.init()
						.render();
				}, delay += delaySpeed);

				setTimeout(function(){
					d3.select('.chart4').node().parentNode.classList.add('async--finished');

					Pie('.chart4', true)
						.data(data4)
						.att({
							width: 328,
							height: 328,
							labelMaxWidth: 70,
							showLabels: true,
							innerRadius: 0.5,
							delaySpeed: delaySpeed,
						})
						.init()
						.render();
				}, delay += delaySpeed);

				setTimeout(function(){
					d3.select('.chart1').node().parentNode.classList.add('async--finished');

					Line('.chart1', true)
						.data(data)
						.att({
							width: 1020,
							xLabel: "Set",
							yLabel: "Weight",
							margin: {
								left: 50
							},
							xScale: 'linear',
							xTicks: (data[0].values.length / 5),
							delaySpeed: delaySpeed,
						})
						.render();
				}, delay += delaySpeed);

				setTimeout(function(){
					d3.select('.chart5').node().parentNode.classList.add('async--finished');

					Line('.chart5', true)
						.data(data5)
						.att({
							width: 1020,
							xLabel: "Week",
							yLabel: "Weight",
							margin: {
								left: 50
							},
							xScale: 'date',
							yMin: 50,
							yMax: 100,
							delaySpeed: delaySpeed,
						})
						.render();
				}, delay += delaySpeed);

				document.querySelector('.d3__list--workouts').onclick = function(e){
					if(e.target.classList.contains('d3__list--workouts')){
						return;
					}

			    	chartManager.htmlWorkout('.d3-exercise', gym.workout(e.target.innerHTML));
			    	this.querySelector('.externalLink').classList.remove('externalLink');
			    	e.target.classList.add('externalLink');
			    };
			});

			/*document.querySelector('.js-chartSelect').onchange = function(){
		    	chartManager.chartIndex = this.selectedIndex;
		    	chartManager.update();
		    };*/
		}
	</script>

{{/base}}